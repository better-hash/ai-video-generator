# 剧本格式指南

## 📋 剧本结构

AI视频生成工具支持以下剧本格式：

### 1. 基础格式

```
标题：剧本标题

场景：场景描述
角色：角色名（性别，年龄，外貌描述，性格特点）

角色名：对话内容
角色名：对话内容

场景：下一个场景描述
角色：角色名（性别，年龄，外貌描述，性格特点）

角色名：对话内容
```

### 2. 详细格式示例

```
标题：浪漫晚餐

场景：高级餐厅，烛光晚餐，浪漫氛围
角色：小明（男，30岁，西装革履，成熟稳重，事业有成）
角色：小丽（女，28岁，优雅连衣裙，温柔美丽，知性大方）

小明：今晚的月亮真美。
小丽：是啊，和你一起看更美。
小明：你总是这么会说话。
小丽：我只是说出心里话而已。
小明：那我们以后经常一起看月亮吧。
小丽：好啊，我期待着呢。

场景：餐厅外，月光下的街道
角色：小明（男，30岁，西装革履，成熟稳重）
角色：小丽（女，28岁，优雅连衣裙，温柔美丽）

小明：我送你回家吧。
小丽：谢谢，今晚真的很开心。
小明：我也是，希望下次还能一起。
小丽：一定会的。
```

## 🎭 角色描述规则

### 角色格式
```
角色：角色名（性别，年龄，外貌描述，性格特点）
```

### 角色描述要素
1. **性别**: 男/女
2. **年龄**: 具体年龄或年龄段
3. **外貌描述**: 服装、发型、特征等
4. **性格特点**: 性格、职业、背景等

### 角色描述示例
```
角色：小明（男，30岁，西装革履，成熟稳重，事业有成）
角色：小丽（女，28岁，优雅连衣裙，温柔美丽，知性大方）
角色：老师（女，45岁，职业装，严肃认真，经验丰富）
角色：学生（男，20岁，休闲装，年轻活力，求知欲强）
```

## 🎬 场景描述规则

### 场景格式
```
场景：场景描述
```

### 场景描述要素
1. **地点**: 具体场所
2. **环境**: 氛围、天气、时间等
3. **道具**: 重要物品或背景元素

### 场景描述示例
```
场景：高级餐厅，烛光晚餐，浪漫氛围
场景：公园，阳光明媚，鸟语花香
场景：办公室，现代简约，专业氛围
场景：咖啡厅，温馨舒适，轻松氛围
场景：街道，夜晚，霓虹灯闪烁
```

## 💬 对话格式规则

### 对话格式
```
角色名：对话内容
```

### 对话规则
1. **角色名**: 必须与角色定义中的名称一致
2. **冒号**: 使用中文冒号（：）
3. **内容**: 对话内容，支持中文标点

### 对话示例
```
小明：今晚的月亮真美。
小丽：是啊，和你一起看更美。
小明：你总是这么会说话。
小丽：我只是说出心里话而已。
```

## 📝 完整剧本示例

### 示例1：简单对话
```
标题：初次见面

场景：咖啡厅，温馨舒适，下午时光
角色：张三（男，25岁，休闲装，阳光开朗，程序员）
角色：李四（女，23岁，清新装扮，温柔可爱，设计师）

张三：你好，我是张三。
李四：你好，我是李四。
张三：很高兴认识你。
李四：我也是。
```

### 示例2：复杂剧情
```
标题：求婚惊喜

场景：海边，夕阳西下，浪漫氛围
角色：男主角（男，30岁，正装，深情款款，事业有成）
角色：女主角（女，28岁，优雅长裙，惊喜感动，温柔贤惠）

男主角：亲爱的，我们在一起已经五年了。
女主角：是啊，时间过得真快。
男主角：这五年里，你给了我很多快乐和温暖。
女主角：你也是，让我的生活更加美好。
男主角：所以，我想和你共度余生。
女主角：我也是这么想的。
男主角：那么，你愿意嫁给我吗？
女主角：我愿意！
```

## ⚠️ 注意事项

### 1. 格式要求
- 使用中文标点符号
- 角色名前后保持一致
- 场景描述要具体详细
- 对话要自然流畅

### 2. 内容限制
- 角色数量：建议2-4个角色
- 场景数量：建议1-3个场景
- 对话长度：每个角色建议2-5句对话
- 总时长：建议5-15秒

### 3. 避免的问题
- 角色名不一致
- 场景描述过于简单
- 对话内容过长
- 特殊字符或表情符号

## 🔧 修复建议

### 1. 修复API接口问题

在`backend/main.py`中修改剧本解析接口：

```python
@router.post("/scripts/parse")
async def parse_script(script_data: dict):
    try:
        # 直接使用传入的字典数据
        parser = ScriptParser()
        script = parser.parse_script(script_data.get("content", ""))
        
        # 添加标题
        if hasattr(script, 'title'):
            script.title = script_data.get("title", "未命名剧本")
        
        return {
            "script_id": str(uuid.uuid4()),
            "parsed_data": {
                "title": getattr(script, 'title', '未命名剧本'),
                "characters": getattr(script, 'characters', []),
                "scenes": getattr(script, 'scenes', []),
                "dialogues": getattr(script, 'dialogues', [])
            }
        }
    except Exception as e:
        raise HTTPException(status_code=500, detail=f"剧本解析失败: {str(e)}")
```

### 2. 修复AI模型导入问题

在`backend/models/video_generator.py`中添加：

```python
def _init_ai_models(self):
    """初始化AI模型"""
    try:
        import torch  # 添加这行
        from diffusers import StableVideoDiffusionPipeline, StableDiffusionPipeline
        from transformers import pipeline
        
        # ... 其余代码保持不变
```

## 🎯 测试剧本

使用以下剧本进行测试：

```
标题：测试视频

场景：公园，阳光明媚，绿树成荫
角色：测试角色（男，25岁，休闲装，年轻活力）

测试角色：这是一个测试视频。
测试角色：希望一切正常。
```

这个格式应该能够正常工作并生成视频！ 